#!/bin/bash

for selinuxvariant in targeted
do
  if /usr/sbin/semodule -s $selinuxvariant -l >/dev/null; then
    # TRANSACTION 1
    /usr/sbin/semanage -S $selinuxvariant -i - << _EOT1
      module -a /usr/share/selinux/${selinuxvariant}/foreman.pp.bz2
      boolean -m --on httpd_setrlimit
_EOT1
    # TRANSACTION 2
    /usr/sbin/semanage -S $selinuxvariant -i - << _EOT2
      port -a -t elasticsearch_port_t -p tcp 9200-9300
_EOT2
    # OPTIONAL COMMANDS
    # If pulp-selinux is installed, turn on puppet management
    semanage boolean -l | grep ^pulp_manage_puppet && semanage boolean -m --on pulp_manage_puppet
  fi
done
